@if (Incomes == null)
{
    <RepositoryWrapper TRepository="IIncomeRepository"
                       Action="x => x.GetAllByUserIdAsync(UserId)"
                       TResponse="IReadOnlyList<Core.Models.Income>"
                       Context="incomes">
    @{
        Incomes = incomes;
    }
    </RepositoryWrapper>
}

<Select @bind-Value="SelectedIncome"
        DataSource="Incomes"
        Placeholder="Select an income..."
        OnSelectedItemChanged="SelectedIncomeChangedInternal"
        DefaultValue="SelectFirst ? GetDefaultValue() : null">
</Select>

@code
{
    [CascadingParameter(Name = CascadingConstants.UserIdWrapper)]
    public string UserId { get; set; }

    [CascadingParameter(Name = CascadingConstants.RepositoryWrapper)]
    public IReadOnlyList<Income> Incomes { get; set; }

    [Parameter]
    public Income SelectedIncome { get; set; }

    [Parameter]
    public EventCallback<Income> SelectedIncomeChanged { get; set; }

    [Parameter]
    public bool SelectFirst { get; set; } = true;

    private void SelectedIncomeChangedInternal(Income selectedItem)
    {
        SelectedIncome = selectedItem;
        
        SelectedIncomeChanged.InvokeAsync(SelectedIncome);
    }

    private Income GetDefaultValue()
    {
        var firstIncome = Incomes.FirstOrDefault();
        return firstIncome;
    }
}